<template>
    <lightning-card title="ÏàôÎ∞ïÏóÖÏÜå Î¶¨Îìú Í≤ÄÏÉâ" icon-name="standard:lead">
        <div class="slds-p-horizontal_medium">
            <!-- Í≤ÄÏÉâ ÌïÑÌÑ∞ -->
            <div class="search-filters slds-m-bottom_medium">
                <div class="slds-grid slds-gutters">
                    <div class="slds-col slds-size_1-of-3">
                        <lightning-combobox
                            name="sigun"
                            label="Ïãú/Íµ∞"
                            value={selectedSigun}
                            placeholder="Ïãú/Íµ∞ ÏÑ†ÌÉù"
                            options={sigunOptions}
                            onchange={handleSigunChange}>
                        </lightning-combobox>
                    </div>
                    <div class="slds-col slds-size_1-of-3">
                        <lightning-combobox
                            name="induType"
                            label="ÏóÖÏ¢Ö"
                            value={selectedInduType}
                            placeholder="Ï†ÑÏ≤¥"
                            options={induTypeOptions}
                            onchange={handleInduTypeChange}>
                        </lightning-combobox>
                    </div>
                    <div class="slds-col slds-size_1-of-3 slds-align-bottom">
                        <lightning-button
                            variant="brand"
                            label="Í≤ÄÏÉâ"
                            title="ÏàôÎ∞ïÏóÖÏÜå Í≤ÄÏÉâ"
                            icon-name="utility:search"
                            onclick={handleSearch}
                            disabled={isSearchDisabled}
                            class="slds-m-top_small">
                        </lightning-button>
                    </div>
                </div>
            </div>
            
            <!-- Í≤ÄÏÉâ Í≤∞Í≥º ÏöîÏïΩ -->
            <template if:true={totalCount}>
                <div class="search-summary slds-m-bottom_small">
                    <p class="slds-text-body_regular">
                        <strong>{totalCount}Í∞ú</strong>Ïùò ÏàôÎ∞ïÏóÖÏÜåÍ∞Ä Í≤ÄÏÉâÎêòÏóàÏäµÎãàÎã§.
                    </p>
                </div>
            </template>
            
            <!-- Î°úÎî© Ïä§ÌîºÎÑà -->
            <template if:true={isLoading}>
                <div class="slds-text-align_center slds-m-bottom_medium">
                    <lightning-spinner alternative-text="Î°úÎî© Ï§ë..." size="small"></lightning-spinner>
                </div>
            </template>
            
            <!-- Ïò§Î•ò Î©îÏãúÏßÄ -->
            <template if:true={errorMessage}>
                <div class="slds-m-bottom_medium">
                    <div class="slds-notify slds-notify_alert slds-alert_error">
                        <span class="slds-assistive-text">Ïò§Î•ò</span>
                        <h2>{errorMessage}</h2>
                    </div>
                </div>
            </template>
            
            <!-- ÏßÄÎèÑ ÏòÅÏó≠ -->
            <div class="map-container">
                <div class="map-div" lwc:dom="manual"></div>
                
                <!-- Ìôà Î≤ÑÌäº (ÏôºÏ™Ω ÏÉÅÎã®) -->
                <button class="map-control-btn home-btn" onclick={goToHome} title="Í∏∞Î≥∏ ÏúÑÏπòÎ°ú">
                    <lightning-icon icon-name="utility:home" size="small"></lightning-icon>
                </button>
            </div>
            
            <!-- Î≤îÎ°Ä -->
            <template if:true={isMapInitialized}>
                <div class="legend-container slds-m-top_medium">
                    <div class="slds-text-title_caps slds-m-bottom_x-small">ÏóÖÏ¢Ö Î≤îÎ°Ä</div>
                    <div class="legend-items">
                        <span class="legend-item">
                            <span class="legend-marker legend-pension">
                                <span class="legend-icon">üè°</span>
                            </span>
                            <span class="legend-label">ÌéúÏÖò</span>
                        </span>
                        <span class="legend-item">
                            <span class="legend-marker legend-minbak">
                                <span class="legend-icon">üè†</span>
                            </span>
                            <span class="legend-label">ÎØºÎ∞ï</span>
                        </span>
                    </div>
                </div>
            </template>
            
            <!-- ÏàôÎ∞ïÏóÖÏÜå Î¶¨Ïä§Ìä∏ -->
            <template if:false={hasNoResults}>
                <template if:true={displayedLodgings.length}>
                    <div class="lodging-list-container slds-m-top_large">
                        <div class="slds-card">
                            <div class="slds-card__header slds-grid">
                                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                    <div class="slds-media__figure">
                                        <lightning-icon icon-name="standard:location" size="small"></lightning-icon>
                                    </div>
                                    <div class="slds-media__body">
                                        <h2 class="slds-card__header-title">
                                            <span>ÏàôÎ∞ïÏóÖÏÜå Î™©Î°ù</span>
                                        </h2>
                                    </div>
                                </header>
                            </div>
                            <div class="slds-card__body">
                                <div class="lodging-list" onscroll={handleScroll}>
                                    <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-table_striped">
                                        <thead>
                                            <tr class="slds-line-height_reset">
                                                <th class="slds-text-title_caps" scope="col">
                                                    <div class="slds-truncate" title="ÏóÖÏÜåÎ™Ö">ÏóÖÏÜåÎ™Ö</div>
                                                </th>
                                                <th class="slds-text-title_caps" scope="col">
                                                    <div class="slds-truncate" title="ÏóÖÏ¢Ö">ÏóÖÏ¢Ö</div>
                                                </th>
                                                <th class="slds-text-title_caps hide-on-mobile" scope="col">
                                                    <div class="slds-truncate" title="Ï£ºÏÜå">Ï£ºÏÜå</div>
                                                </th>
                                                <th class="slds-text-title_caps" scope="col">
                                                    <div class="slds-truncate" title="Í∞ùÏã§Ïàò">Í∞ùÏã§</div>
                                                </th>
                                                <th class="slds-text-title_caps hide-on-mobile" scope="col">
                                                    <div class="slds-truncate" title="Ï†ÑÌôîÎ≤àÌò∏">Ï†ÑÌôîÎ≤àÌò∏</div>
                                                </th>
                                                <th class="slds-text-title_caps" scope="col">
                                                    <div class="slds-truncate" title="Ïï°ÏÖò">Ïï°ÏÖò</div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template for:each={displayedLodgings} for:item="lodging" for:index="index">
                                                <tr key={lodging.bizName} class="slds-hint-parent">
                                                    <td data-label="ÏóÖÏÜåÎ™Ö">
                                                        <div class="slds-truncate" title={lodging.bizName}>
                                                            {lodging.bizName}
                                                        </div>
                                                    </td>
                                                    <td data-label="ÏóÖÏ¢Ö">
                                                        <div class="slds-truncate">
                                                            <span class="indutype-badge">
                                                                <span class={lodging.iconClass}></span>
                                                                {lodging.induType}
                                                            </span>
                                                        </div>
                                                    </td>
                                                    <td data-label="Ï£ºÏÜå" class="hide-on-mobile">
                                                        <div class="slds-truncate" title={lodging.roadAddr}>
                                                            {lodging.roadAddr}
                                                        </div>
                                                    </td>
                                                    <td data-label="Í∞ùÏã§Ïàò">
                                                        <div class="slds-truncate">
                                                            {lodging.roomCnt}Í∞ú
                                                        </div>
                                                    </td>
                                                    <td data-label="Ï†ÑÌôîÎ≤àÌò∏" class="hide-on-mobile">
                                                        <div class="slds-truncate">
                                                            {lodging.telNo}
                                                        </div>
                                                    </td>
                                                    <td data-label="Ïï°ÏÖò">
                                                        <div class="action-buttons">
                                                            <button 
                                                                class="slds-button slds-button_icon slds-button_icon-border-filled"
                                                                onclick={handleViewLocation}
                                                                data-index={index}
                                                                title="ÏúÑÏπò Î≥¥Í∏∞">
                                                                <lightning-icon 
                                                                    icon-name="utility:location" 
                                                                    size="x-small"
                                                                    alternative-text="ÏúÑÏπò Î≥¥Í∏∞">
                                                                </lightning-icon>
                                                            </button>
                                                            <button 
                                                                class="slds-button slds-button_icon slds-button_icon-border-filled slds-m-left_x-small"
                                                                onclick={handleConvertToLead}
                                                                data-index={index}
                                                                title="Î¶¨Îìú Ï†ÑÌôò">
                                                                <lightning-icon 
                                                                    icon-name="utility:lead" 
                                                                    size="x-small"
                                                                    alternative-text="Î¶¨Îìú Ï†ÑÌôò">
                                                                </lightning-icon>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                    
                                    <!-- Ï∂îÍ∞Ä Î°úÎî© ÌëúÏãú -->
                                    <template if:true={isLoadingMore}>
                                        <div class="slds-text-align_center slds-p-vertical_small">
                                            <lightning-spinner alternative-text="Ï∂îÍ∞Ä Î°úÎî© Ï§ë..." size="small"></lightning-spinner>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>
            
            <!-- Í≤∞Í≥º ÏóÜÏùå -->
            <template if:true={hasNoResults}>
                <div class="slds-align_absolute-center slds-p-vertical_large">
                    <div class="slds-text-align_center">
                        <lightning-icon icon-name="standard:location" size="large"></lightning-icon>
                        <p class="slds-text-heading_medium slds-p-top_medium">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>
                        <p class="slds-text-body_regular slds-text-color_weak">Îã§Î•∏ ÏßÄÏó≠Ïù¥ÎÇò ÏóÖÏ¢ÖÏúºÎ°ú Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî.</p>
                    </div>
                </div>
            </template>
        </div>
    </lightning-card>
</template>